<!doctype html>
<html>
<head>

<title>Drawing</title>
<script>
    let id
    let mouseX
	let mouseY
	let pmouseX=0
	let pmouseY=0
    let BX
    let BY
    let start;
    let deltaTime = 1 / 60
    const fps = 60
    class physics 
    {
        constructor(ctx,canvas,body1X, body1Y, body2X, body2Y, body3X, body3Y) 
        {
            this.infB = 
            [
                [
                    (Math.pow(10, 16) * 3.978),         //mass of body 1
                    0,                                  //X velocity of body 1
                    0,                                  //Y velocity of body 1
                    body1X,                             //X position of body 1
                    body1Y                              //Y position of body 1
                ],
                [
                    (Math.pow(10, 13) * 2),             //mass of body 2
                    0,                                  //X velocity of body 2
                    (Math.pow(10, 1) * 8.94),           //Y velocity of body 2
                    body2X,                             //X position of body 2
                    body2Y                              //Y position of body 2
                ],
                [
                    (Math.pow(10, 1) * 1.4695346),      //mass of body 3
                    0,                                  //X velocity of body 3
                    (Math.pow(10, 2) * 1),              //Y velocity of body 3
                    body3X,                             //X position of body 3
                    body3Y                              //Y position of body 3
                ]
            ]
            this.ctx = ctx;
            this.canvas = canvas;
            this.Gconst = Math.pow(10, -11) * 6.67408
            
        }
        timestep()
        {
            
            ////update the positions of each body
            render(this.ctx, this.canvas, this.infB[0][3], this.infB[0][4], this.infB[1][3], this.infB[1][4], this.infB[2][3], this.infB[2][4]);
            const acc12 = this.gravity(this.infB[0][0], this.infB[0][3], this.infB[0][4], this.infB[1][3], this.infB[1][4]);
            const acc21 = this.gravity(this.infB[1][0], this.infB[1][3], this.infB[1][4], this.infB[0][3], this.infB[0][4]); 
            const acc31 = this.gravity(this.infB[2][0], this.infB[2][3], this.infB[2][4], this.infB[0][3], this.infB[0][4]); 
            const acc32 = this.gravity(this.infB[2][0], this.infB[2][3], this.infB[2][4], this.infB[1][3], this.infB[1][4]); 
            const acc13 = this.gravity(this.infB[0][0], this.infB[0][3], this.infB[0][4], this.infB[2][3], this.infB[2][4]);
            const acc23 = this.gravity(this.infB[1][0], this.infB[1][3], this.infB[1][4], this.infB[2][3], this.infB[2][4]);  

            this.infB[2][1] += acc13[0] * deltaTime;
            this.infB[2][2] += acc13[1] * deltaTime;
            this.infB[2][1] += acc23[0] * deltaTime;
            this.infB[2][2] += acc23[1] * deltaTime;
            this.infB[2][3] += this.infB[2][1] * deltaTime
            this.infB[2][4] += this.infB[2][2] * deltaTime

            this.infB[1][1] += acc12[0] * deltaTime;
            this.infB[1][2] += acc12[1] * deltaTime;
            this.infB[1][1] += acc32[0] * deltaTime;
            this.infB[1][2] += acc32[1] * deltaTime;
            this.infB[1][3] += this.infB[1][1] * deltaTime
            this.infB[1][4] += this.infB[1][2] * deltaTime

            this.infB[0][1] += acc21[0] * deltaTime;
            this.infB[0][2] += acc21[1] * deltaTime;
            this.infB[0][1] += acc31[0] * deltaTime;
            this.infB[0][2] += acc31[1] * deltaTime;
            this.infB[0][3] += this.infB[0][1] * deltaTime
            this.infB[0][4] += this.infB[0][2] * deltaTime
        }
        
        gravity(m1, x1, y1, x2, y2)
        {
            const acc = this.getAcc(m1, x1, y1, x2, y2)
            const angle = this.getAngle(x1, y1, x2, y2)
            if(angle >= 0)
            {
                return [acc * Math.cos(angle) * -1, //x acceleration
                    acc * Math.sin(angle)]          //y acceleration
            }
            else
            {
                return [0,0]
            }
        }

        getDistance(xDifference, yDifference)
        {
            return Math.sqrt(Math.pow(xDifference, 2) + Math.pow(yDifference, 2))
        }

        getForce(m1, x1, y1, m2, x2, y2)
        {
            return this.Gconst * ((m2 * m1) / math.pow(this.getDistance(x1 - x2, y1 - y2), 2))
        }

        getAcc(m1, x1, y1, x2, y2)
        {
            return this.Gconst * ((m1) / Math.pow(this.getDistance(x1 - x2, y1 - y2), 2))
        }

        getAngle(x1, y1, x2, y2)
        {
            const xDifference = x1 - x2                                         //gets X difference between the 2 points specified
            const yDifference = y1 - y2                                         //gets Y difference between the 2 points specified
            let angleRad = (Math.atan(Math.abs(yDifference / xDifference)))     // gets the angle from 0-90 degrees
            
            if(xDifference > 0 && yDifference <= 0)                             //offsets the angle depending on quadrant
            {
                angleRad += Math.PI
            }
            else if(xDifference > 0 && yDifference > 0)
            {
                angleRad = Math.PI - angleRad
            }
            else if(xDifference <= 0 && yDifference < 0)
            {
                angleRad = 2 * Math.PI - angleRad
            }
            return angleRad //returns the angle
        }
        
        
    }
    
    var canvas
    
	function loaded(){
        //code goes here
        canvas=document.getElementById("myCanvas")
        var ctx=canvas.getContext("2d")
        var phys = new physics(ctx, canvas, 400, 400, 694, 400, 684, 400)
        canvas.addEventListener("mousemove", followMouse,false,phys)
        
        id = setInterval(update,1000/fps,phys);
	}//end of code
    function update(phys)
    {
        //start = performance.now();
        phys.timestep()
        //duration = (performance.now() - start ) / 1000;
    }
    function render(ctx, canvas, b1X, b1Y, b2X, b2Y, b3X, b3Y)
    {
        ctx.clearRect(0, 0, canvas.width, canvas.height);// clears the canvas
        ctx.beginPath();
        ctx.arc(b1X,b1Y,10,0,2*Math.PI); // parameters are x,y,radius,starting angle in radians, ending angle in radians, 
        ctx.closePath();
        ctx.fillStyle="red";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(b2X,b2Y,3,0,2*Math.PI); // parameters are x,y,radius,starting angle in radians, ending angle in radians, 
        ctx.closePath();
        ctx.fillStyle="black";
        ctx.fill();
        ctx.beginPath();
        ctx.arc(b3X,b3Y,1,0,2*Math.PI); // parameters are x,y,radius,starting angle in radians, ending angle in radians, 
        ctx.closePath();
        ctx.fillStyle="black";
        ctx.fill();
    }
    function followMouse(e,phys)
	{
        pmouseX = mouseX
        pmouseY = mouseY
        mouseX = event.x;
        mouseY = event.y;

        //var canvas = document.getElementById("canvas");

        mouseX -= canvas.offsetLeft;
        mouseY -= canvas.offsetTop;
		BX = mouseX
		BY = mouseY
    }
</script>
</head>


<body onLoad="loaded()">
<canvas id="myCanvas" width="1000" height="1000"></canvas>
</body>
</html>


