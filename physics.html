<!doctype html>
<html>
<head>
<title>physics</title>
<link href="styles.css" rel="stylesheet">
<script>
    //global variables
    let id
    let start;
    let deltaTime = 1 / 60
    let phys
    let pause = true
    const fps = 60
    
    class physics 
    {
        constructor(ctx,canvas,body1X, body1Y, body2X, body2Y, body3X, body3Y) 
        {
            //contains info for all of the bodies
            this.infB = //stores info for all of the bodies
            [
                [
                    (Math.pow(10, 16) * 3.978),         //mass of body 1
                    0,                                  //X velocity of body 1
                    0,                                  //Y velocity of body 1
                    body1X,                             //X position of body 1
                    body1Y,                             //Y position of body 1
                    10,                                 //diameter of object
                    '#ff0000'                           //colour of object
                ],
                [
                    (Math.pow(10, 13) * 1),             //mass of body 2
                    0,                                  //X velocity of body 2
                    (Math.pow(10, 1) * 9.94),           //Y velocity of body 2
                    body2X,                             //X position of body 2
                    body2Y,                             //Y position of body 2
                    5,                                  //diameter of object
                    '#ffffff'                           //colour of object
                ],
                [
                    (Math.pow(10, 1) * 1.9695346),      //mass of body 3
                    0,                                  //X velocity of body 3
                    (Math.pow(10, 2) * 1.08),           //Y velocity of body 3
                    body3X,                             //X position of body 3
                    body3Y,                             //Y position of body 3
                    1,                                  //diameter of object
                    '#ffffff'                           //colour of object
                ]
            ]
            this.ctx = ctx;
            this.canvas = canvas;
            this.Gconst = Math.pow(10, -11) * 6.67408
            this.render(this.ctx, this.canvas);//renders all of the objects
        }
        timestep()//runs every frame to update positions
        {
            
            
            this.render(this.ctx, this.canvas);//renders all of the objects
            
            for(this.i = 0; this.i < this.infB.length; this.i++)//body 1
            {
                for(this.j = 0; this.j < this.infB.length; this.j++)//body 2
                {
                    if(this.j != this.i)
                    {
                        var acc = this.gravity(this.j, this.i) // get the acceleration on an object

                        // apply that acceleration to speed
                        this.infB[this.i][1] += acc[0] * deltaTime
                        this.infB[this.i][2] += acc[1] * deltaTime
                        //check if two bodies are colliding
                        if(this.getDistance(this.infB[this.i][3] - this.infB[this.j][3], this.infB[this.i][4] - this.infB[this.j][4]) <= this.infB[this.i][5] + this.infB[this.j][5])
                        {
                            this.collision(this.i, this.j);//handles the collision
                        }
                    }
                }
            }
            
            // applies the speed to affect the position of the objects
            for(this.i = 0; this.i < this.infB.length; this.i++)
            {
                this.infB[this.i][3] += this.infB[this.i][1] * deltaTime
                this.infB[this.i][4] += this.infB[this.i][2] * deltaTime
            }
        }
        
        gravity(b1, b2)//calculates x and y accelerations of gravity
        {
            const acc = this.getAcc(this.infB[b1][0], this.infB[b1][3], this.infB[b1][4], this.infB[b2][3], this.infB[b2][4])//get acceleration
            const angle = this.getAngle(this.infB[b1][3], this.infB[b1][4], this.infB[b2][3], this.infB[b2][4])//get angle

            //convert angle and acceleration to angle
            if(angle >= 0)
            {
                return [acc * Math.cos(angle) * -1, //x acceleration
                    acc * Math.sin(angle)]          //y acceleration
            }
            else
            {
                return [0,0]
            }
        }

        collision(b1, b2)//decides how collisions are handled
        {
            if(this.infB[b1][0] > this.infB[b2][0])//checks what body is bigger
            {
                this.infB[b1][0] += this.infB[b2][0]//adds the bodies mass
                this.infB[b1][5] = Math.sqrt((this.infB[b2][5] * this.infB[b2][5]) + (this.infB[b1][5] * this.infB[b1][5]))//adds the bodies 
                //this.infB[b2][5] += this.infB[b1][5]
                this.infB.splice(b2,1)
            }
            else
            {
                this.infB[b2][0] += this.infB[b1][0]
                this.infB[b2][5] = Math.sqrt((this.infB[b2][5] * this.infB[b2][5]) + (this.infB[b1][5] * this.infB[b1][5]))
                //this.infB[b2][5] += this.infB[b1][5]
                this.infB.splice(b1,1)
            }
        }

        getDistance(xDifference, yDifference)//gets distance between 2 objects
        {
            return Math.sqrt(Math.pow(xDifference, 2) + Math.pow(yDifference, 2))
        }

        getForce(m1, x1, y1, m2, x2, y2)// gets force between two objects(not used)
        {
            return this.Gconst * ((m2 * m1) / math.pow(this.getDistance(x1 - x2, y1 - y2), 2))
        }

        getAcc(m1, x1, y1, x2, y2)//gets acceleration between 2 bodies
        {
            return this.Gconst * ((m1) / Math.pow(this.getDistance(x1 - x2, y1 - y2), 2))
        }

        getAngle(x1, y1, x2, y2)//gets angle from body 1 to 2
        {
            const xDifference = x1 - x2                                         //gets X difference between the 2 points specified
            const yDifference = y1 - y2                                         //gets Y difference between the 2 points specified
            let angleRad = (Math.atan(Math.abs(yDifference / xDifference)))     // gets the angle from 0-90 degrees
            
            if(xDifference > 0 && yDifference <= 0)                             //offsets the angle depending on quadrant
            {
                angleRad += Math.PI
            }
            else if(xDifference > 0 && yDifference > 0)
            {
                angleRad = Math.PI - angleRad
            }
            else if(xDifference <= 0 && yDifference < 0)
            {
                angleRad = 2 * Math.PI - angleRad
            }
            return angleRad //returns the angle
        }
        
        render(ctx, canvas)//render the planets
        {
            ctx.clearRect(0, 0, canvas.width, canvas.height);// clears the canvas
            for(this.i = 0; this.i < this.infB.length; this.i++)
            {
                ctx.beginPath();
                ctx.arc(this.infB[this.i][3],this.infB[this.i][4],this.infB[this.i][5],0,2*Math.PI); // parameters are x,y,radius,starting angle in radians, ending angle in radians, 
                ctx.closePath();
                ctx.fillStyle=this.infB[this.i][6];
                ctx.fill();
            }
        }
        
    }
    
    var canvas
    var ctx
	function loaded(){
        //code goes here
        canvas=document.getElementById("myCanvas")
        ctx=canvas.getContext("2d")
        phys = new physics(ctx, canvas, 400, 400, 694, 400, 684, 400)//initialises the physics engine
        
        id = setInterval(update,1000/fps);//fps = framerate
	}//end of code
    function update()
    {
        if(!pause)phys.timestep()//check if game is paused
    }

    function objAdd()
    {
        //gets values from text boxes
        let velX = document.getElementById('txtXVel').value
        let velY = document.getElementById('txtYVel').value
        let posX = document.getElementById('txtXPos').value
        let posY = document.getElementById('txtYPos').value
        let mass = document.getElementById('txtMass').value
        let colo = document.getElementById('txtcol').value
        let radi = document.getElementById('txtRad').value
        let obj = document.getElementById('txtObj').value
        if  
        (//checks if inputs are strings
            (parseInt(velX) ||
            parseInt(velY) ||
            parseInt(posX) ||
            parseInt(posY) ||
            parseInt(mass) ||
            parseInt(radi)) &&
            phys.infB.length - 1 < obj//checks if you are trying to add a new object
        ) 
        {//adds new object
            //adds the new values to the infb array
            phys.infB.push([])
            obj = phys.infB.length - 1//sets obj to the right value
            phys.infB[obj].push(
                
                    parseInt(mass), 
                    parseInt(velX), 
                    parseInt(velY), 
                    parseInt(posX), 
                    parseInt(posY), 
                    parseInt(radi),
                    colo
                )
        }
        else
        {
            //changes the values of the object to be changed
            if(mass != 'u')phys.infB[obj][0] = parseInt(mass)
            if(velX != 'u')phys.infB[obj][1] = parseInt(velX)
            if(velY != 'u')phys.infB[obj][2] = parseInt(velY)
            if(posX != 'u')phys.infB[obj][3] = parseInt(posX)
            if(posY != 'u')phys.infB[obj][4] = parseInt(posY)
            if(radi != 'u')phys.infB[obj][5] = parseInt(radi)
            if(radi != 'u')phys.infB[obj][5] = parseInt(radi)
        }
        phys.render(ctx, canvas)
    }

    function btnPause()
    {
        pause = !pause//pauses the simulation
    }

</script>
</head>


<body onLoad="loaded()">
<canvas id="myCanvas" width="1800" height="1000"></canvas>
</body>
<body>
    <p>
        <label for="txtObj">object to change</label>
        <input type="text" name="txtObj" id="txtObj">
        <label for="txt2">
            <br>
            <br>
        </label>

        <label for="txtXPos">X position</label>
        <input type="text" name="txtXPos" id="txtXPos">
        <label for="txt2">
            <br>
            <br>
        </label>

        <label for="txtYPos">Y position</label>
        <input type="text" name="txtYPos" id="txtYPos">
        <label for="txt2">
            <br>
            <br>
        </label>

        <label for="txtXVel">X velocity</label>
        <input type="text" name="txtXVel" id="txtXVel">
        <label for="txt2">
            <br>
          <br>
        </label>
        <label for="txtYVel">Y velocity</label>
        <input type="text" name="txtYVel" id="txtYVel">
        <label for="txt2">
            <br>
            <br>
        </label>
        <label for="txtMass">Mass</label>
        <input type="text" name="txtMass" id="txtMass">
        <label for="txt2">
            <br>
            <br>
        </label>
        <label for="txtRad">radius</label>
        <input type="text" name="txtRad" id="txtRad">
        <label for="txt2">
            <br>
            <br>
        </label>
        <label for="txtcol">colour</label>
        <input type="text" name="txtcol" id="txtcol">
        <label for="txt2">
            <br>
            <br>
        </label>
    </p>
    
      <input onClick="objAdd()" type="button" name="button" id="button" value="set">
    </p>
    </p>

    <input onClick="btnPause()" type="button" name="button" id="button" value="pause">
    </p>
    <p>&nbsp; </p>
    </body>
</html>